# GitLab CI/CD Pipeline for swimlib Sphinx Documentation
# Deploys to GitLab Pages: https://<username>.gitlab.io/swimlib

image: python:3.13-slim

# Cache Poetry dependencies for faster builds
cache:
  paths:
    - .cache/pip
    - .venv/

# Install Poetry before running scripts
before_script:
  - pip install --upgrade pip
  - pip install poetry
  - poetry config virtualenvs.in-project true
  - poetry install --with docs

# GitLab Pages deployment job
# Builds Sphinx documentation and deploys to GitLab Pages
pages:
  stage: deploy
  script:
    # Build Sphinx documentation
    - poetry run sphinx-build -b html docs public
    # Display build info
    - echo "Documentation built successfully"
    - ls -lah public/
  artifacts:
    paths:
      - public
  rules:
    # Only deploy from the main/master branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
